# integration-tests.yaml
# ============================================================================
# 통합 테스트 정의 파일
# ============================================================================
# 이 파일은 Agent의 여러 구성 요소가 함께 작동하는지 테스트하는
# 통합 테스트 시나리오를 정의합니다.
# (예: Knowledge Base + 도구 호출, 전체 대화 흐름 등)
# ============================================================================

testSuite:
  name: Customer Support Agent Integration Tests
  version: 1.0.0

tests:
  # --------------------------------------------------------------------------
  # Knowledge Base 검색 통합 테스트
  # --------------------------------------------------------------------------
  # 실제 벡터 스토어에 연결하여 검색이 작동하는지 확인
  - name: test_knowledge_base_search
    type: integration
    description: Knowledge Base 검색 통합 테스트
    
    # 테스트 전제 조건 (이 조건들이 만족되어야 테스트 실행)
    prerequisites:
      - knowledge_base_synced: true  # Knowledge Base가 동기화되어 있어야 함
    
    input:
      query: "반품 정책은 무엇인가요?"  # 검색 쿼리
      max_results: 3  # 최대 결과 수
    
    expected:
      results_count: ">= 1"  # 최소 1개 이상의 결과가 반환되어야 함
      first_result_contains: "반품"  # 첫 번째 결과에 "반품" 키워드 포함
    timeout: 10

  # --------------------------------------------------------------------------
  # 티켓 생성 워크플로우 테스트
  # --------------------------------------------------------------------------
  # 실제 API를 호출하여 티켓이 생성되는지 확인
  - name: test_ticket_creation_workflow
    type: integration
    description: 티켓 생성 워크플로우 테스트
    
    prerequisites:
      - api_available: true  # 티켓 API가 사용 가능해야 함
    
    input:
      title: "테스트 티켓"
      description: "통합 테스트용 티켓입니다"
      priority: "medium"  # 우선순위: low, medium, high, urgent
      customer_id: "test_customer_001"
    
    expected:
      ticket_id_exists: true  # 티켓 ID가 반환되어야 함
      status: "open"  # 티켓 상태가 "open"이어야 함
    timeout: 15

  # --------------------------------------------------------------------------
  # End-to-End 대화 흐름 테스트
  # --------------------------------------------------------------------------
  # 사용자와 Agent 간의 전체 대화가 올바르게 진행되는지 확인
  - name: test_end_to_end_conversation
    type: integration
    description: 전체 대화 흐름 테스트
    
    input:
      # 대화 이력 (여러 턴의 대화)
      conversation:
        - role: user  # 사용자 발화
          content: "제품 반품을 하고 싶어요"
        - role: assistant  # Agent 응답
          content: "반품 절차에 대해 안내해드리겠습니다"
        - role: user  # 사용자 후속 질문
          content: "어떻게 진행하나요?"
    
    expected:
      response_contains: ["절차", "안내"]  # Agent 응답에 포함되어야 할 키워드
      tools_used: ["search-knowledge-base"]  # 사용되어야 할 도구 목록
    timeout: 30
